import{k as xe,l as c,r as P,D as ee,u as Se,j as o,F as Ce,m as be,n as Ee,c as je,d as ke,T as we}from"./index-NPOR4z2-.js";import{r as Pe}from"./index-Chjiymov.js";var Ne=Pe();const u=xe(Ne);function z(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(r,a).enumerable})),t.push.apply(t,n)}return t}function G(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?z(Object(t),!0).forEach(function(n){te(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):z(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}function U(r){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?U=function(e){return typeof e}:U=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},U(r)}function te(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function re(r,e){return Oe(r)||_e(r,e)||Re(r,e)||Ae()}function Oe(r){if(Array.isArray(r))return r}function _e(r,e){var t=r&&(typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"]);if(t!=null){var n=[],a=!0,s=!1,l,m;try{for(t=t.call(r);!(a=(l=t.next()).done)&&(n.push(l.value),!(e&&n.length===e));a=!0);}catch(i){s=!0,m=i}finally{try{!a&&t.return!=null&&t.return()}finally{if(s)throw m}}return n}}function Re(r,e){if(r){if(typeof r=="string")return H(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return H(r,e)}}function H(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,n=new Array(e);t<e;t++)n[t]=r[t];return n}function Ae(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var x=function(e,t,n){var a=!!n,s=c.useRef(n);c.useEffect(function(){s.current=n},[n]),c.useEffect(function(){if(!a||!e)return function(){};var l=function(){s.current&&s.current.apply(s,arguments)};return e.on(t,l),function(){e.off(t,l)}},[a,t,e,s])},q=function(e){var t=c.useRef(e);return c.useEffect(function(){t.current=e},[e]),t.current},N=function(e){return e!==null&&U(e)==="object"},Te=function(e){return N(e)&&typeof e.then=="function"},Ie=function(e){return N(e)&&typeof e.elements=="function"&&typeof e.createToken=="function"&&typeof e.createPaymentMethod=="function"&&typeof e.confirmCardPayment=="function"},J="[object Object]",Le=function r(e,t){if(!N(e)||!N(t))return e===t;var n=Array.isArray(e),a=Array.isArray(t);if(n!==a)return!1;var s=Object.prototype.toString.call(e)===J,l=Object.prototype.toString.call(t)===J;if(s!==l)return!1;if(!s&&!n)return e===t;var m=Object.keys(e),i=Object.keys(t);if(m.length!==i.length)return!1;for(var S={},g=0;g<m.length;g+=1)S[m[g]]=!0;for(var C=0;C<i.length;C+=1)S[i[C]]=!0;var h=Object.keys(S);if(h.length!==m.length)return!1;var k=e,f=t,v=function(w){return r(k[w],f[w])};return h.every(v)},ne=function(e,t,n){return N(e)?Object.keys(e).reduce(function(a,s){var l=!N(t)||!Le(e[s],t[s]);return n.includes(s)?(l&&console.warn("Unsupported prop change: options.".concat(s," is not a mutable property.")),a):l?G(G({},a||{}),{},te({},s,e[s])):a},null):null},ae="Invalid prop `stripe` supplied to `Elements`. We recommend using the `loadStripe` utility from `@stripe/stripe-js`. See https://stripe.com/docs/stripe-js/react#elements-props-stripe for details.",X=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ae;if(e===null||Ie(e))return e;throw new Error(t)},De=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ae;if(Te(e))return{tag:"async",stripePromise:Promise.resolve(e).then(function(a){return X(a,t)})};var n=X(e,t);return n===null?{tag:"empty"}:{tag:"sync",stripe:n}},Me=function(e){!e||!e._registerWrapper||!e.registerAppInfo||(e._registerWrapper({name:"react-stripe-js",version:"2.9.0"}),e.registerAppInfo({name:"react-stripe-js",version:"2.9.0",url:"https://stripe.com/docs/stripe-js/react"}))},W=c.createContext(null);W.displayName="ElementsContext";var oe=function(e,t){if(!e)throw new Error("Could not find Elements context; You need to wrap the part of your app that ".concat(t," in an <Elements> provider."));return e},se=function(e){var t=e.stripe,n=e.options,a=e.children,s=c.useMemo(function(){return De(t)},[t]),l=c.useState(function(){return{stripe:s.tag==="sync"?s.stripe:null,elements:s.tag==="sync"?s.stripe.elements(n):null}}),m=re(l,2),i=m[0],S=m[1];c.useEffect(function(){var h=!0,k=function(v){S(function(E){return E.stripe?E:{stripe:v,elements:v.elements(n)}})};return s.tag==="async"&&!i.stripe?s.stripePromise.then(function(f){f&&h&&k(f)}):s.tag==="sync"&&!i.stripe&&k(s.stripe),function(){h=!1}},[s,i,n]);var g=q(t);c.useEffect(function(){g!==null&&g!==t&&console.warn("Unsupported prop change on Elements: You cannot change the `stripe` prop after setting it.")},[g,t]);var C=q(n);return c.useEffect(function(){if(i.elements){var h=ne(n,C,["clientSecret","fonts"]);h&&i.elements.update(h)}},[n,C,i.elements]),c.useEffect(function(){Me(i.stripe)},[i.stripe]),c.createElement(W.Provider,{value:i},a)};se.propTypes={stripe:u.any,options:u.object};var Ue=function(e){var t=c.useContext(W);return oe(t,e)},We=function(){var e=Ue("calls useElements()"),t=e.elements;return t};u.func.isRequired;var ie=c.createContext(null);ie.displayName="CheckoutSdkContext";var Be=function(e,t){if(!e)throw new Error("Could not find CheckoutProvider context; You need to wrap the part of your app that ".concat(t," in an <CheckoutProvider> provider."));return e},Fe=c.createContext(null);Fe.displayName="CheckoutContext";u.any,u.shape({clientSecret:u.string.isRequired,elementsOptions:u.object}).isRequired;var K=function(e){var t=c.useContext(ie),n=c.useContext(W);if(t&&n)throw new Error("You cannot wrap the part of your app that ".concat(e," in both <CheckoutProvider> and <Elements> providers."));return t?Be(t,e):oe(n,e)},qe=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},d=function(e,t){var n="".concat(qe(e),"Element"),a=function(i){var S=i.id,g=i.className,C=i.options,h=C===void 0?{}:C,k=i.onBlur,f=i.onFocus,v=i.onReady,E=i.onChange,w=i.onEscape,O=i.onClick,_=i.onLoadError,de=i.onLoaderStart,pe=i.onNetworksChange,fe=i.onConfirm,me=i.onCancel,he=i.onShippingAddressChange,ve=i.onShippingRateChange,T=K("mounts <".concat(n,">")),I="elements"in T?T.elements:null,L="checkoutSdk"in T?T.checkoutSdk:null,ye=c.useState(null),$=re(ye,2),y=$[0],ge=$[1],j=c.useRef(null),B=c.useRef(null);x(y,"blur",k),x(y,"focus",f),x(y,"escape",w),x(y,"click",O),x(y,"loaderror",_),x(y,"loaderstart",de),x(y,"networkschange",pe),x(y,"confirm",fe),x(y,"cancel",me),x(y,"shippingaddresschange",he),x(y,"shippingratechange",ve),x(y,"change",E);var F;v&&(e==="expressCheckout"?F=v:F=function(){v(y)}),x(y,"ready",F),c.useLayoutEffect(function(){if(j.current===null&&B.current!==null&&(I||L)){var b=null;L?b=L.createElement(e,h):I&&(b=I.create(e,h)),j.current=b,ge(b),b&&b.mount(B.current)}},[I,L,h]);var Y=q(h);return c.useEffect(function(){if(j.current){var b=ne(h,Y,["paymentRequest"]);b&&"update"in j.current&&j.current.update(b)}},[h,Y]),c.useLayoutEffect(function(){return function(){if(j.current&&typeof j.current.destroy=="function")try{j.current.destroy(),j.current=null}catch{}}},[]),c.createElement("div",{id:S,className:g,ref:B})},s=function(i){K("mounts <".concat(n,">"));var S=i.id,g=i.className;return c.createElement("div",{id:S,className:g})},l=t?s:a;return l.propTypes={id:u.string,className:u.string,onChange:u.func,onBlur:u.func,onFocus:u.func,onReady:u.func,onEscape:u.func,onClick:u.func,onLoadError:u.func,onLoaderStart:u.func,onNetworksChange:u.func,onConfirm:u.func,onCancel:u.func,onShippingAddressChange:u.func,onShippingRateChange:u.func,options:u.object},l.displayName=n,l.__elementType=e,l},p=typeof window>"u",Ke=c.createContext(null);Ke.displayName="EmbeddedCheckoutProviderContext";var $e=function(){var e=K("calls useStripe()"),t=e.stripe;return t};d("auBankAccount",p);var V=d("card",p);d("cardNumber",p);d("cardExpiry",p);d("cardCvc",p);d("fpxBank",p);d("iban",p);d("idealBank",p);d("p24Bank",p);d("epsBank",p);d("payment",p);d("expressCheckout",p);d("currencySelector",p);d("paymentRequestButton",p);d("linkAuthentication",p);d("address",p);d("shippingAddress",p);d("paymentMethodMessaging",p);d("affirmMessage",p);d("afterpayClearpayMessage",p);var ce="https://js.stripe.com/v3",Ye=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,Q="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",ze=function(){for(var e=document.querySelectorAll('script[src^="'.concat(ce,'"]')),t=0;t<e.length;t++){var n=e[t];if(Ye.test(n.src))return n}return null},Z=function(e){var t="",n=document.createElement("script");n.src="".concat(ce).concat(t);var a=document.head||document.body;if(!a)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return a.appendChild(n),n},Ge=function(e,t){!e||!e._registerWrapper||e._registerWrapper({name:"stripe-js",version:"5.1.0",startTime:t})},R=null,D=null,M=null,He=function(e){return function(){e(new Error("Failed to load Stripe.js"))}},Je=function(e,t){return function(){window.Stripe?e(window.Stripe):t(new Error("Stripe.js not available"))}},Xe=function(e){return R!==null?R:(R=new Promise(function(t,n){if(typeof window>"u"||typeof document>"u"){t(null);return}if(window.Stripe&&e&&console.warn(Q),window.Stripe){t(window.Stripe);return}try{var a=ze();if(a&&e)console.warn(Q);else if(!a)a=Z(e);else if(a&&M!==null&&D!==null){var s;a.removeEventListener("load",M),a.removeEventListener("error",D),(s=a.parentNode)===null||s===void 0||s.removeChild(a),a=Z(e)}M=Je(t,n),D=He(n),a.addEventListener("load",M),a.addEventListener("error",D)}catch(l){n(l);return}}),R.catch(function(t){return R=null,Promise.reject(t)}))},Ve=function(e,t,n){if(e===null)return null;var a=e.apply(void 0,t);return Ge(a,n),a},A,ue=!1,le=function(){return A||(A=Xe(null).catch(function(e){return A=null,Promise.reject(e)}),A)};Promise.resolve().then(function(){return le()}).catch(function(r){ue||console.warn(r)});var Qe=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];ue=!0;var a=Date.now();return le().then(function(s){return Ve(s,t,a)})};const Ze=()=>{const{state:r,dispatch:e}=P.useContext(ee),[t,n]=P.useState(!1),[a,s]=P.useState(null),[l,m]=P.useState(!1),i=Se(),S=$e(),g=We(),C=f=>{var v,E;(v=f==null?void 0:f.error)!=null&&v.message?s((E=f==null?void 0:f.error)==null?void 0:E.message):s("")},h=r.basket.reduce((f,v)=>v.price*v.amount+f,0),k=async f=>{f.preventDefault(),m(!0);try{const w=(await(await fetch(`https://my-amazon-u75f.onrender.com/payment-create?total=${h*100}`,{method:"POST",headers:{"Content-Type":"application/json"}})).json()).clientSecret,O=await S.confirmCardPayment(w,{payment_method:{card:g.getElement(V)}});if(O.error){i("");return}else if(O.paymentIntent){let _=O.paymentIntent;await be(Ee(je(ke,"users"),r.user.uid,"orders",_.id),{basket:r.basket,amount:_.amount,created:_.created}),localStorage.setItem("userUID",r.user.uid),e({type:we.EMPTY_BASKET}),i("/order",{state:{msg:"you have placed new order"}})}m(!1)}catch(v){console.log(v),m(!1),i("")}};return o.jsx("form",{onSubmit:k,style:{width:"700px",margin:"auto"},children:o.jsxs("div",{className:"Payment_place_content",children:[o.jsx("h1",{children:"Proceed here to complete your payment"}),o.jsxs("div",{style:tt,children:[o.jsx(V,{onChange:C,options:et}),o.jsx("span",{style:{color:"red",display:"block"},children:a}),o.jsx("button",{type:"submit",style:{marginTop:"20px",padding:"10px 20px",background:"#5469d4",color:"#fff",border:"none",borderRadius:"4px",cursor:"pointer"},disabled:!S||t,children:l?o.jsx("div",{style:{transform:"scale(0.4)",display:"inline-block"},children:o.jsx(Ce,{height:15,width:5,color:"#123abc"})}):"Pay Now"})]})]})})},et={style:{base:{color:"#32325d",fontFamily:"'Helvetica Neue', Helvetica, sans-serif",fontSmoothing:"antialiased",fontSize:"16px",border:"2px solid gray","::placeholder":{color:"#aab7c4"}},invalid:{color:"#fa755a",iconColor:"#fa755a"}}},tt={width:"100%",padding:"15px",border:"1px solid #ccc",borderRadius:"8px",marginBottom:"20px",background:"#f9f9f9",display:"flex",gap:"18px",flexDirection:"column"},at=()=>{var n;const{state:r,dispatch:e}=P.useContext(ee);P.useState(!1);const t=Qe("pk_test_51Q1mMR07cCSzXErvwrM5mwcHF8F7S6BIcETn5XjAFT8b5hbR2RPbDKKwwk03nf8iJu6HlKOTYvqdNe4IpkwTWgpt00oNE5pJP3");return r.basket==""?o.jsx("div",{className:"basket_empty_show",children:o.jsx("h2",{children:"Oops! Your basket is empty. Letâ€™s fill it with something amazing!"})}):o.jsx("section",{className:"cart_main_container",children:o.jsxs("div",{className:"lefSideItem_content_container",children:[o.jsxs("div",{className:"cartItem_header",children:[o.jsxs("h1",{className:"cart_page_title",children:["Checkout:(",r.basket.length,") items"]}),o.jsxs("div",{className:"email_address",children:[o.jsx("span",{children:"Delivary Adrdess"}),o.jsxs("div",{children:[o.jsx("div",{children:(n=r.user)==null?void 0:n.email}),o.jsx("div",{children:"123react Lane"}),o.jsx("div",{children:"Chicago LI"})]})]})]}),o.jsx("hr",{}),o.jsxs("div",{className:"cart_list_container",children:[r.basket.map(a=>o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"item_list",children:[o.jsx("div",{className:"cartItemImg",children:o.jsx("img",{src:a.image||a.images[0],alt:""})}),o.jsxs("div",{className:"cartIitemContentContainer",children:[o.jsxs("div",{children:[o.jsxs("p",{children:[a.description,"..."]}),o.jsx("div",{children:o.jsxs("span",{className:"inStock_container",children:[o.jsx("span",{className:"inStock",children:"in stock"}),o.jsxs("span",{className:"thisIs_Gifet_text_container",children:[o.jsx("input",{type:"checkbox"}),o.jsx("span",{children:"this is a Gift"})]})]})})]}),o.jsxs("div",{className:"price_limited_day_container",children:[o.jsxs("span",{className:"itemOff_number",children:[Math.floor(Math.random()*60),"%off"]}),o.jsx("span",{className:"limited_deal",children:"Limited time deal"}),o.jsxs("span",{className:"Typical_price",children:["Typical price: ",a.price]})]})]})]}),o.jsx("hr",{})]})),o.jsx(se,{stripe:t,children:o.jsx(Ze,{})})]})]})})};export{at as default};
